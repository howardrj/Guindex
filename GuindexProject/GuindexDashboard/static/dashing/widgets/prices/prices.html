<div>
    <h1> Submit a Price </h1>

    <!-- Search Bar -->
    <input id="pub_search_bar" type="text" placeholder=" Search Pubs ...">

    <ul id="pubs_list" style="margin-top: 10px;">
        <li id="empty_pub_list_indicator" style="display:none"> No Pubs </li>
    </ul>

    <script>
        // Make this globally accessible
        var g_pubsList = [];
        
        // Fetch pub data
        var request = new XMLHttpRequest();
        request.open('GET', API_URL_BASE + 'pubs/', true); 

        request.setRequestHeader('Content-Type', 'application/json');
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

        request.send(null);

        request.onreadystatechange = function processRequest()
        {
            if (request.readyState == 4 && request.status == 200)
            {
                // Parse pubs
                var g_pubsList = JSON.parse(request.responseText);

                // If no pubs, display notice in list
                if (!g_pubsList.length)
                {
                    document.getElementById('empty_pub_list_indicator').style.display = 'block';
                    return;
                }

                // Sort alphabetically
                g_pubsList.sort(function(a, b) {
                    return a['name'] - b['name'];
                });

                // Add to pubs list
                for (var i = 0; i < g_pubsList.length; i++)
                {
                    var li = document.createElement('li'); 

                    li.setAttribute('id', g_pubsList[i]['id']);
                    li.classList.add('pub_list_item');
                    li.innerHTML = g_pubsList[i]['name'];

                    document.getElementById('pubs_list').appendChild(li);
                } 
		    }
	    }
        
        // Refine list each time input changes
        document.getElementById('pub_search_bar').addEventListener('input', function (evt) {

            var search_text  = evt.target.value.toLowerCase();
            var matched_pubs = 0;

            var pub_list_items = document.getElementsByClassName('pub_list_item');

            for (var i = 0; i < pub_list_items.length; i++)
            {
                if (pub_list_items[i].innerHTML.toLowerCase().indexOf(search_text) != -1)
                {
                    matched_pubs++;
                    pub_list_items[i].style.display = 'block';
                }
                else
                {
                    pub_list_items[i].style.display = 'none';
                }
                
                if (matched_pubs)
                {
                    document.getElementById('empty_pub_list_indicator').style.display = 'none';
                }
                else
                {
                    document.getElementById('empty_pub_list_indicator').style.display = 'block';
                }
            }
        });

    </script>

</div>
